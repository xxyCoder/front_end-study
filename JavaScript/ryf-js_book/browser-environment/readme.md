# 浏览器环境
- 浏览器内置了JS引擎，提供了各种接口
- script中的type属性，如果其值浏览器不认识那么浏览器不会执行其中代码
- script中的integrity属性，写入该脚本的的Hash签名，用来验证脚本的一致性（有人更改导致不匹配签名，浏览器不执行代码）

## URL协议
- URL支持javascript:协议，即在URL写入代码，使这个URL的时候就会执行JS代码
- 将代码放入浏览器地址按回车也会执行代码
- 如果 JavaScript 代码返回一个字符串，浏览器就会新建一个文档，展示这个字符串的内容，原有文档的内容都会消失

## script元素
1. 浏览器一边下载 HTML 网页，一边开始解析。也就是说，不等到下载完，就开始解析。
2. 解析过程中，浏览器发现 script 元素，就暂停解析，把网页渲染的控制权转交给 JavaScript 引擎。
3. 如果 script 元素引用了外部脚本，就下载该脚本再执行，否则就直接执行代码。
4. JavaScript 引擎执行完毕，控制权交还渲染引擎，恢复往下解析 HTML 网页。
- 脚本可以获取DOM的时机
  - 脚本放底部执行
  - DOMContentLoaded事件的回调
  - script的onload属性（当srcipt指定的外部脚本文件下载和解析完成，才会触发onload）
- 解决脚本文件下载阻塞网页渲染的问题
  - defer属性，延迟脚本的执行，等到DOM加载生成后，再执行脚本
    1. 浏览器开始解析HTML页面
    2. 解析过程发现script并且带有defer属性
    3. 浏览器继续解析HTML页面，同时并行下载script元素的外部脚本
    4. HTML页面解析完成，此时回过头执行已经下载完的script脚本
  - async属性，使用另一个进程下载脚本，下载时不会阻塞渲染，但是无法保证script之间的执行顺序
    1. 浏览器开始解析HTML
    2. 解析过程中发现有script并带有async属性
    3. 浏览器继续解析HTML网页，同时并行下载script外部脚本
    4. 脚本下载完，浏览器暂停解析HTML网页，开始执行下载脚本
    5. 脚本解析完毕，浏览器恢复执行
  - 同时使用defer和async，浏览器行为由async决定

## 加载时使用的协议
- 不执行协议默认是http

## 浏览器组成
- 核心部分：渲染引擎、JS解析器（JS引擎）
- 渲染引擎主要是将网页代码渲染成用户视觉可以感知的平面文档
  1. 解析代码，HTML解析为DOM，CSS解析为CSSOM
  2. 对象合并，将DOM和CSSOM合并成渲染树
  3. 布局，计算渲染树节点大小等
  4. 绘制，将渲染树绘制到屏幕上
  - 并非严格按顺序执行
- JS引擎主要是读取JS代码，对其处理后运行

## 重流和重绘
- 页面生成后，脚本、样式表操作和用户互动（悬停改变样式）都会触发重流和重绘
- 重流必然导致重绘，重绘不一定导致重流
- 优化技巧
  - 读取或写入DOM，尽量一起，不要读一个然后立刻写入
  - 使用documentFragment操作DOM
  - 动画使用absolute或fixed定位，这样可以减少对其他元素的影响
  - 使用window.requestAnimationFrame()，把代码执行推迟到下一次重绘之前执行，而不是立即重绘
  - 使用虚拟DOM